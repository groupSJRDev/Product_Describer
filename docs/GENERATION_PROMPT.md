# Nano Banana Pro Prompt Documentation

## Overview

This document explains the exact prompt structure sent to Google's Nano Banana Pro (Gemini 3 Pro Image) for generating product images from technical specifications.

## Prompt Structure

The prompt sent to Nano Banana Pro consists of three main sections sent in a specific order:

### 1. Technical Constraints (Header)
```
Please generate product with these exact ratios. 
Exact label of reference.
No metrics on the final image.
```

**Purpose**: Sets the primary directive for the generation
- Instructs to use exact ratios from specifications
- Requests exact label reproduction from reference image
- Prevents measurement annotations in the generated output

**Why**: Establishes that this is a precision reconstruction task, not a creative interpretation.

---

### 2. Complete YAML Specifications (Core)
```yaml
{yaml_specs}
```

**Purpose**: Embeds the entire technical specification YAML generated by GPT-5.2 analysis

**Content includes** (for the Stasher bag example):
- **Product metadata**: Type, branding, capacity
- **Dimensions**: Width (8.5"), height (10.25"), ratios, mm conversions
- **Geometry**: 
  - Corner fillet radius (0.777")
  - Top edge arch (0.413" rise)
  - Side angles from vertical (2.75°-3.54°)
  - Width ratio variations by vertical position
- **Material properties**: 
  - Base material (silicone elastomer)
  - Thickness estimates (1.0-1.6mm wall, 2.5-4.5mm rim)
  - Closure type (press/pinch-seal)
- **Optical properties**:
  - Refractive index (1.40-1.43)
  - Fresnel reflectance (0.029)
  - Translucency characteristics
  - Light transmission color shifts
- **Colors in HEX**:
  - Body mid: #EDEEF3 (clear), #D9E7EF (aqua)
  - Rim highlight: #F1F3F7 (clear), #D6DFE3 (aqua)
  - Light transmission delta: [-1, +7, +12] RGB

**Why**: Provides complete, unambiguous technical specifications for accurate reconstruction. The YAML format is structured and parseable, giving the model precise numerical targets.

---

### 3. Emphasis on Precision
```
Pay special attention to:
- Exact color hex codes
- Material properties (transparency, refraction, reflection)
- Geometry and proportions
- Exact curves and angles
- Optical characteristics

DO NOT deviate from ANY specifications.
DO NOT add details to the product not described.
```

**Purpose**: Reinforces critical aspects and sets boundaries
- Highlights the most important technical attributes
- Explicitly prohibits creative deviation
- Prevents hallucination of features not in specifications

**Why**: AI image models tend toward creative interpretation. These directives constrain the model to technical accuracy over aesthetics.

---

### 4. Custom User Prompt
```
{custom_prompt}
```

**Purpose**: User-specified scene composition and styling instructions

**Examples**:
- "Show this product filled with marbles on an all white background"
- "Please generate multiple instances of this product... They are in a pile and each one is filled with some kind of object"
- "Create a professional studio product photograph with neutral white background"

**Default** (if not specified):
```
Create a professional studio product photograph of this item.
The lighting should be clean and even, showing all details clearly.
The background should be neutral white.
Match the technical specifications exactly, especially colors, materials, and proportions.
```

**Why**: Allows user control over context, lighting, background, and scene composition while maintaining technical accuracy. This is the "creative" component where user intent shapes presentation.

---

### 5. Final Reinforcement
```
You must follow all metric descriptions EXACTLY. Product maintains instructed color and exact dimensions.
```

**Purpose**: Final directive emphasizing precision
- Reiterates that metrics are mandatory, not suggestions
- Emphasizes both color fidelity and dimensional accuracy

**Why**: Acts as a "closing argument" to ensure the model prioritizes technical accuracy in the final synthesis.

---

## Complete Prompt Flow

```
[HEADER: Technical Constraints]
↓
[CORE: Complete YAML Specifications - 500-2000+ lines]
↓
[EMPHASIS: Critical Attributes & Boundaries]
↓
[CUSTOM: User Scene Composition]
↓
[REINFORCEMENT: Final Precision Directive]
```

## Prompt Design Rationale

### 1. **Specification-First Structure**
The YAML specs come early in the prompt because they establish the "ground truth" that everything else must respect. By placing them before the custom prompt, we ensure they have semantic priority.

### 2. **Repetition of Constraints**
The prompt repeats precision requirements three times (header, emphasis, reinforcement) because:
- AI models can "forget" early instructions in long prompts
- Repetition reinforces critical constraints
- Different phrasings cover different aspects of precision

### 3. **Explicit Negatives**
"DO NOT" statements are included because:
- Models often add creative embellishments
- Explicit prohibition is more effective than implied constraints
- Prevents hallucination of features (e.g., adding logos not in specs)

### 4. **User Prompt Placement**
The custom prompt comes near the end because:
- It should modify presentation, not override specifications
- Technical constraints are established first
- Scene composition is the last creative layer

### 5. **HEX Color Emphasis**
Colors are called out specifically because:
- Color is notoriously difficult for AI image models to match precisely
- HEX codes provide unambiguous targets
- Lighting/context affects color perception

## Inputs to the Generation

Along with the text prompt, Nano Banana Pro receives:

1. **Reference Image**: First image from `data/<PRODUCT_NAME>/`
   - Provides visual context for style, texture, lighting
   - Helps model understand material appearance
   - Reference for label design and placement

2. **Prompt Text**: The complete structured prompt described above

3. **Configuration**:
   - Model: `gemini-3-pro-image-preview`
   - Response modalities: `['TEXT', 'IMAGE']`
   - Aspect ratio: `1:1` (default, configurable via `IMAGE_ASPECT_RATIO`)
   - Resolution: `2K` (default, configurable via `IMAGE_RESOLUTION`)

## Example Output

When this prompt is sent with Stasher bag specifications, Nano Banana Pro generates:
- Product image matching 8.5" × 10.25" aspect ratio
- Silicone appearance with appropriate translucency
- Corner radii of ~0.777" (19.74mm)
- Color matching #D9E7EF (aqua body) or #EDEEF3 (clear variant)
- Slight top edge arch (0.413" rise)
- Custom scene elements (marbles, creek objects, studio lighting, etc.)

## Customization Methods

Users can customize the scene via three methods (priority order):

1. **Environment Variable** (highest priority):
   ```bash
   GENERATION_PROMPT="Your prompt" make generate
   ```

2. **Prompt File**:
   ```bash
   echo "Your prompt" > temp/<PRODUCT_NAME>/generation_prompt.txt
   make generate
   ```

3. **Default**: Professional studio product photograph (used if neither above is set)

## Why This Approach Works

1. **Structured Data**: YAML specifications are parseable and unambiguous
2. **Layered Instructions**: Technical specs → constraints → creativity → reinforcement
3. **Explicit Boundaries**: Multiple "DO NOT" statements prevent deviation
4. **Visual Reference**: Reference image provides material/texture context
5. **User Control**: Custom prompt allows scene composition without compromising accuracy
6. **Reinforcement**: Critical requirements repeated for emphasis

This prompt structure balances technical precision (via comprehensive YAML specs) with creative flexibility (via user custom prompts) to generate accurate product visualizations.
